








Changes only in Hortonworks git repo and not in released hive-1.2.1
===================================================================
NEW FEATURES
  HDP-2.6.0:     HIVE-15473: Progress Bar on Beeline client
    HIVE-15847: In Progress update refreshes seem slow
    HIVE-16045: Print progress bar along with operation log
    HIVE-15891: Detect query rewrite scenario for UPDATE/DELETE/MERGE and fail fast 
    HIVE-15970: Merge statement implementation clashes with AST rewrites
    HIVE-15668: change REPL DUMP syntax to use "LIMIT" instead of "BATCH" keywordHIVE-15478: Add file + checksum list for create table/partition during notification creation (whenever relevant)
    HIVE-15534: Update db/table repl.last.id at the end of REPL LOAD of a batch of events 
    HIVE-15469: Fix REPL DUMP/LOAD DROP_PTN so it works on non-string-ptn-key tables 
    HIVE-15365: Add new methods to MessageFactory API (corresponding to the ones added in JSONMessageFactory) 
    HIVE-15525: Hooking ChangeManager to "drop table", "drop partition"
    HIVE-15366: REPL LOAD & DUMP support for incremental INSERT events 
    HIVE-15522: REPL LOAD & DUMP support for incremental ALTER_TABLE/ALTER_PTN including renames 
    HIVE-15448: ChangeManager 
    HIVE-15466: REPL LOAD & DUMP support for incremental DROP_TABLE/DROP_PTN 
    HIVE-15426: Fix order guarantee of event executions for REPL LOAD 
    HIVE-15294: Capture additional metadata to replicate a simple insert at destination 
    HIVE-15333: Add a FetchTask to REPL DUMP plan for reading dump uri, last repl id as ResultSet 
    HIVE-15332: REPL LOAD & DUMP support for incremental CREATE_TABLE/ADD_PTN 
    HIVE-13836: DbNotifications giving an error = Invalid state. Transaction has already started 
    HIVE-15284: Add junit test to test replication scenarios 
    HIVE-15151: Bootstrap support for replv2 
    HIVE-15180: Extend JSONMessageFactory to store additional information about metadata objects on different table events 
    HIVE-15232: Add notification events for functions and indexes 
    HIVE-15871: Add cross join check in SQL MERGE stm 
    HIVE-15755: NullPointerException on invalid table name in ON clause of Merge statement

  Pre-HDP-2.5.4:
    HIVE-10924: add support for MERGE statement
    HIVE-11030: Enhance storage layer to create one delta file per write
    HIVE-14943: Base Implementation (merge statement)
    HIVE-14948: properly handle special characters in identifiers
    HIVE-14993: make WriteEntity distinguish writeType
    HIVE-15010: Make LockComponent aware if it's part of dynamic partition operation
    HIVE-15307: Hive MERGE: "when matched then update" allows invalid column names.

IMPROVEMENTS
  HDP-2.6.0:     HIVE-16181: Make logic for hdfs directory location extraction more generic, in webhcat test driver
    HIVE-13936: Add streaming support for row_number
    HIVE-14929: Adding JDBC test for query cancellation scenario
    HIVE-14445: upgrade maven surefire to 2.19.1 
    HIVE-14935: Add tests for beeline force option
    HIVE-10562: Add versioning/format mechanism to NOTIFICATION_LOG entries, expand MESSAGE size
    HIVE-15871: enable cardinality check by default
    HIVE-15579: Support HADOOP_PROXY_USER for secure impersonation in hive metastore client     HIVE-15717: JDBC: Implement rowDeleted, rowInserted and rowUpdated to return false      HIVE-7224: Set incremental printing to true by default in Beeline 

  Pre-HDP-2.5.4:

BUG FIXES
  HDP-2.6.0:     HIVE-16114: NullPointerException in TezSessionPoolManager when getting the session
    HIVE-16175: Possible race condition in InstanceCache 
    HIVE-16160: OutOfMemoryError: GC overhead limit exceeded on Hs2 longevity tests
    HIVE-16172: Switch to a fairness lock to synchronize HS2 thrift client
    HIVE-16170: Exclude relocation of org.apache.hadoop.security.* in the JDBC standalone jar
    HIVE-15848: count or sum distinct incorrect when hive.optimize.reducededuplication set to true 
    HIVE-16102: Grouping sets do not conform to SQL standard
    HIVE-16086: Fix HiveMetaStoreChecker.checkPartitionDirsSingleThreaded method
    HIVE-16090: Addendum to HIVE-16014
    HIVE-16014: HiveMetastoreChecker should use hive.metastore.fshandler.threads instead of hive.mv.files.thread for pool size
    HIVE-15879: Fix HiveMetaStoreChecker.checkPartitionDirs method
    HIVE-15851: SHOW COMPACTIONS doesn't show JobID
    HIVE-16070: fix nonReserved list in IdentifiersParser.g
    HIVE-15941: Fix o.a.h.hive.ql.exec.tez.TezTask compilation issue with tez master
    HIVE-16050: Regression: Union of null with non-null
    HIVE-11935: Race condition in HiveMetaStoreClient: isCompatibleWith and close
    HIVE-11616: DelegationTokenSecretManager reuses the same objectstore, which has concurrency issues
    HIVE-15935: ACL is not set in ATS data
    HIVE-15830: Allow additional ACLs for tez jobs.
    HIVE-16028: Fail UPDATE/DELETE/MERGE queries when Ranger authorization manager is used
    HIVE-15999: Fix flakiness in TestDbTxnManager2 
    HIVE-15872: The PERCENTILE_APPROX UDAF does not work with empty set
    HIVE-15002: HiveSessionImpl#executeStatementInternal may leave locks in an inconsistent state 
    HIVE-9941: sql std authorization on partitioned table: truncate and insert
    HIVE-14375: hcatalog-pig-adaptor pom.xml uses joda-time 2.2 instead of ${joda.version} that uses 2.8.1 
    HIVE-13527: Using deprecated APIs in HBase client causes zookeeper connection leaks 
    HIVE-15936: ConcurrentModificationException in ATSHook
    HIVE-15846: CNF error without hadoop jars, Relocate more dependencies (e.g. org.apache.zookeeper) for JDBC uber jar
    HIVE-15950: Make DbTxnManager use Metastore client consistently with callers
    HIVE-15917: incorrect error handling from BackgroundWork can cause beeline query to hang 
    HIVE-15889: Some tasks still run after hive cli is shutdown
    HIVE-15803: msck can hang when nested partitions are present 
    HIVE-14924: MSCK REPAIR table with single threaded is throwing null pointer exception 
    HIVE-14290: Refactor HIVE-14054 to use Collections#newSetFromMap 
    HIVE-11594: Analyze Table for column names with embedded spaces
    HIVE-15839: Don't force cardinality check if only WHEN NOT MATCHED is specified
    HIVE-15840: Webhcat test TestPig_5 failing with Pig on Tez at check for percent complete of job
    HIVE-13872: Queries failing with java.lang.ClassCastException when vectorization is enabled
    HIVE-14399: Fix test flakiness of org.apache.hive.hcatalog.listener.TestDbNotificationListener.cleanupNotifs 
    HIVE-13966: DbNotificationListener: can loose DDL operation notifications
    HIVE-15542: NPE in StatsUtils::getColStatistics when all values in DATE column are NULL 
    HIVE-13423: Handle the overflow case for decimal datatype for sum() 
    HIVE-14992: Relocate several common libraries in hive jdbc uber jar
    HIVE-15472: JDBC: Standalone jar is missing ZK dependencies
    HIVE-15846: Relocate more dependencies (e.g. org.apache.zookeeper) for JDBC uber jar
    HIVE-15124: Fix OrcInputFormat to use reader's schema for include boolean array
    HIVE-13083: Writing HiveDecimal to ORC can wrongly suppress present stream
    HIVE-14959: Fix DISTINCT with windowing when CBO is enabled/disabled
    HIVE-15099: PTFOperator.PTFInvocation didn't properly reset the input partition	
    HIVE-14278: Migrate TestHadoop20SAuthBridge.java from Unit3 to Unit4
    HIVE-14251: Union All of different types resolves to incorrect data 
    HIVE-14279: fix mvn test TestHiveMetaStore.testTransactionalValidation
    HIVE-14762: Add logging while removing scratch space
    HIVE-14922: Add perf logging for post job completion steps
    HIVE-14690: Query fail when hive.exec.parallel=true, with conflicting session dir
    HIVE-14693: Some paritions will be left out when partition number is the multiple of the option hive.msck.repair.batch.size 
    HIVE-12077: MSCK Repair table should fix partitions in batches
    HIVE-13756: Map failure attempts to delete reducer _temporary dir on pig multi-query
    HIVE-14457: Partitions in encryption zone are still trashed though an exception is returned 
    HIVE-14805: Subquery inside a view will have the object in the subquery as the direct input 
    HIVE-14774: Canceling query using Ctrl-C in beeline might lead to stale locks 
    HIVE-14865 Fix comments after HIVE-14350 
    HIVE-14715: Hive throws NumberFormatException with query with Null value 
    HIVE-14773: NPE aggregating column statistics for date column in partitioned table      HIVE-13185: orc.ReaderImp.ensureOrcFooter() method fails on small text files with IndexOutOfBoundsException     HIVE-14591: HS2 is shut down unexpectedly during the startup time      HIVE-14520: We should set a timeout for the blocking calls in TestMsgBusConnection     HIVE-12968: genNotNullFilterForJoinSourcePlan: needs to merge predicates into the multi-AND     HIVE-15774: Ensure DbLockManager backward compatibility for non-ACID resources      HIVE-15714: backport HIVE-11985 (and HIVE-12601) to branch-1      HIVE-15752: MSCK should add output WriteEntity for table in semantic analysis      HIVE-14436: Hive 1.2.1/Hitting "ql.Driver: FAILED: IllegalArgumentException Error: , expected at the end of 'decimal(9'" after enabling hive.optimize.skewjoin and with MR engine       HIVE-15569: failures in RetryingHMSHandler     HIVE-13014: RetryingMetaStoreClient is retrying too aggressiveley      HIVE-12594: X lock on partition should not conflict with S lock on DB     HIVE-15550: fix arglist logging in schematool      HIVE-14966: Backport: JDBC: HiveConnction never saves HTTP cookies     HIVE-14170: Beeline IncrementalRows should buffer rows and incrementally re-calculate width if TableOutputFormat is used      HIVE-14229: the jars in hive.aux.jar.paths are not added to session classpath         HIVE-11293: HiveConnection.setAutoCommit(true) throws exception         HIVE-14037: java.lang.ClassNotFoundException for the jar in hive.reloadable.aux.jars.path in mapreduce
    HIVE-14229: the jars in hive.aux.jar.paths are not added to session classpath     HIVE-15551: memory leak in directsql for mysql+bonecp specific initialization     HIVE-15322: Skipping "hbase mapredcp" in hive script for certain services
    HIVE-15137: metastore add partitions background thread should use current username     HIVE-15551: memory leak in directsql for mysql+bonecp specific initialization      HIVE-15589: Flaky org.apache.hadoop.hive.ql.lockmgr.TestDbTxnManager.testHeartbeater      HIVE-15684: Wrong posBigTable used in VectorMapJoinOuterFilteredOperator
    HIVE-15291: Comparison of timestamp fails if only date part is provided     HIVE-15437: avro tables join fails when - tbl join tbl_postfix      HIVE-7239: Fix bug in HiveIndexedInputFormat implementation that causes incorrect query result when input backed by Sequence/RC files     HIVE-14659: OutputStream won't close if caught exception in funtion unparseExprForValuesClause in SemanticAnalyzer.java      HIVE-14607: ORC split generation failed with exception: java.lang.ArrayIndexOutOfBoundsException: 1 
    HIVE-14519: Multi insert query bug      HIVE-15178: ORC stripe merge may produce many MR jobs and no merge if split size is small      HIVE-14928: Analyze table no scan mess up schema     HIVE-15231: query on view with CTE and alias fails with table not found error      HIVE-13539: HiveHFileOutputFormat searching the wrong directory for HFiles      HIVE-15327: Outerjoin might produce wrong result depending on joinEmitInterval value      HIVE-15355: Concurrency issues during parallel moveFile due to HDFSUtils.setFullFileStatus
    HIVE-15588: Vectorization: Fix deallocation of scratch columns in VectorUDFCoalesce, etc to prevent wrong reuse
    HIVE-15060: Remove the autoCommit warning from beeline      HIVE-12664: Bug in reduce deduplication optimization causing ArrayOutOfBoundException     HIVE-14837: JDBC: standalone jar is missing hadoop core dependencies
    

  Pre-HDP-2.5.4:
    HIVE-15488: Native Vector MapJoin fails when trying to serialize BigTable rows that have (unreferenced) complex types     HIVE-14448: Queries with predicate fail when ETL split strategy is chosen for ACID tables     HIVE-15338: Wrong result from vectorized DATEDIFF with scalar parameter of type DATE/TIMESTAMP     HIVE-15376: Improve heartbeater scheduling for transactions      HIVE-14688: Hive drop table call fails when Hive metastore directory is in encryption zone      HIVE-13754: Fix resource leak in HiveClientCache      HIVE-14900: fix entry for hive.exec.max.dynamic.partitions in config whitelist for sql std auth     HIVE-14463: hcatalog server extensions test cases getting stuck      HIVE-15493: Wrong result for LEFT outer join in Tez using MapJoinOperator     HIVE-15331: Decimal multiplication with high precision/scale often returns NULL     HIVE-15149: Improve Hive ATS Hook to support Tez UI 1.0     HIVE-14948: properly handle special characters in identifiers (modify test since HIVE-11699 is not in Hive1)
    HIVE-15048: Update/Delete statement using wrong WriteEntity when subqueries are involved
    HIVE-14948: properly handle special characters in identifiers
    HIVE-15307: Hive MERGE: "when matched then update" allows invalid column names.
    HIVE-15337: Enhance Show Compactions output with JobId and start time for "attempted" state
    HIVE-12504: TxnHandler.abortTxn() should check if already aborted to improve message
    HIVE-13383: RetryingMetaStoreClient retries non retriable embedded metastore client
    HIVE-15279: map join dummy operators are not set up correctly in certain cases with merge join      HIVE-15278: PTF+MergeJoin = NPE
    HIVE-15323: allow the user to turn off reduce-side SMB join  
    HIVE-15309: Miscellaneous logging clean up     HIVE-15308: Create ACID table failed intermittently: due to Postgres (SQLState=25P02, ErrorCode=0)     HIVE-15202: compactions can step on each other causing data loss     HIVE-14595: TimestampWritable::setTimestamp gives wrong result when 2nd VInt exists
    HIVE-11957: Add StartedTime and LastHeartbeatTime columns to SHOW TRANSACTIONS output      HIVE-15181: buildQueryWithINClause didn't properly handle multiples of ConfVars.METASTORE_DIRECT_SQL_MAX_ELEMENTS_IN_CLAUSE      HIVE-15236: timestamp and date comparison should happen in timestamp     HIVE-13186: ALTER TABLE RENAME should lowercase table name and hdfs location 
    HIVE-14400: Handle concurrent insert with dynamic partition 
    HIVE-11540: Too many delta files during Compaction - OOM
    HIVE-12202: NPE thrown when reading legacy ACID delta files     HIVE-15120: Storage based auth: allow option to enforce write checks for external tables     HIVE-13931: Update connection pool usage from bonecp to hikaricp     HIVE-15220: WebHCat test driver not capturing end time of test accurately     HIVE-15068: Run ClearDanglingScratchDir periodically inside HS2     HIVE-11120: ORC output format creates 0 length files if no data is written     HIVE-14149: Joda Time causes an AmazonS3Exception on Hadoop3.0.0 
    HIVE-14814: Hive.loadDynamicPartitions (transactional) fails with Nullpointer Exception at hive.ql.exec.MoveTask     HIVE-14766: ObjectStore.initialize() needs retry mechanisms in case of connection failures
    HIVE-14783: bucketing column should be part of sorting for delete/update operation when spdo is on      HIVE-13090: Hive metastore crashes on NPE with ZooKeeperTokenStore      HIVE-13408: Issue appending HIVE_QUERY_ID without checking if the prefix already exists      HIVE-14423: S3: Fetching partition sizes from FS can be expensive when stats are not available in metastore
    HIVE-14764: Enabling hive.metastore.metrics.enabled throws OOM in HiveMetastore     HIVE-14739: Replace runnables directly added to runtime shutdown hooks to avoid deadlock     HIVE-14726: delete statement fails when spdo is on      HIVE-14462: Reduce number of partition check calls in add_partitions      HIVE-14511: Improve MSCK for partitioned table to deal with special cases
    HIVE-13551: Make cleardanglingscratchdir work on Windows     HIVE-13513: cleardanglingscratchdir does not work in some version of HDFS     HIVE-13514: TestClearDanglingScratchDir fail on branch-1     HIVE-13513: cleardanglingscratchdir does not work in some version of HDFS     HIVE-13498: cleardanglingscratchdir does not work if scratchdir is not on defaultFs     HIVE-13429: Tool to remove dangling scratch dir
    HIVE-14411: selecting Hive on Hbase table may cause FileNotFoundException      HIVE-12976: MetaStoreDirectSql doesn't batch IN lists in all cases      HIVE-14674: Incorrect syntax near the keyword 'with' using MS SQL Server     HIVE-12739: Log4j2.x needs HADOOP_USER_CLASSPATH_FIRST to be set
    HIVE-14563: StatsOptimizer treats NULL in a wrong way     HIVE-14479: Add some join tests for acid table      HIVE-12757: Fix TestCodahaleMetrics#testFileReporting      HIVE-14428: HadoopMetrics2Reporter leaks memory if the metrics sink is not configured correctly     HIVE-14441: TestFetchResultsOfLog failures     HIVE-14447: Mapjoin on ACID tables fails with MR Local Work path
    HIVE-12735: Constant folding for WHEN/CASE expression does not set return type correctly     HIVE-14393: Tuple in list feature fails if there's only 1 tuple in the list     HIVE-14414: Fix TestHiveMetaStoreTxns UTs     HIVE-14381: Handle null value in WindowingTableFunction.WindowingIterator.next()      HIVE-14394: Disable INFO logs from HadoopMetrics2Reporter for hive on upgrade to 2.5     HIVE-14322: Postgres db issues after Datanucleus 4.x upgrade     HIVE-12826: Vectorization: fix VectorUDAF* suspect isNull checks      HIVE-14350: Aborted txns cause false positive "Not enough history available..." msgs     HIVE-14366: Conversion of a Non-ACID table to an ACID table produces non-unique primary keys     HIVE-13991: Union All on view fail with no valid permission on underneath table     HIVE-14336: Make usage of VectorUDFAdaptor configurable      HIVE-14348: Add tests for alter table exchange partition] Alter Table Exchange Partition NullPointerException and authorization issues     HIVE-14349: Vectorization: LIKE should anchor the regexes     HIVE-13196: UDFLike: reduce Regex NFA sizes     HIVE-14313: Test failure TestMetaStoreMetrics.testConnections     HIVE-10022: Authorization checks for non existent file/directory should not be recursive     HIVE-14338: Delete/Alter table calls failing with HiveAccessControlException     HIVE-14339: Fix UT failure for acid_globallimit.q      HIVE-14330: fix LockHandle TxnHandler.acquireLock(String key) retry logic      HIVE-14297: OrcRecordUpdater floods logs trying to create _orc_acid_version file     HIVE-14311: No need to schedule Heartbeat task if the query doesn't require locks      HIVE-13934: Configure Tez to make nocondiional task size memory available for the Processor      HIVE-14214: ORC Schema Evolution and Predicate Push Down do not work together (no rows returned)     HIVE-14291: select count(*) query on acid orc table returns 0 even though data is present in table     HIVE-14221: Support masking and filtering of rows/columns: set SQLStdHiveAuthorizerFactoryForTest as default HIVE_AUTHORIZATION_MANAGER     HIVE-14277: Disable StatsOptimizer for all ACID tables 
    HIVE-12429: Switch default Hive authorization to SQLStandardAuth in 2.0      HIVE-14268: INSERT-OVERWRITE is not generating an INSERT event during hive replication     HIVE-14083: ALTER INDEX in Tez causes NullPointerException     HIVE-14292 ACID table creation fails on mysql with MySQLIntegrityConstraintViolationException
 
INTERNAL FIXES (NO APACHE JIRA)
  HDP-2.6.0:
    BUG-77010: Remove relocation for hadoop related artifacts for JDBC standalone jar
    BUG-77709: Stop printing progress info from operation logs with beeline progress bar from hive1 HS2
    BUG-74719: Ensure that SchemaEvolution.getFileIncluded() is never null
    BUG-67801: Disable TestJdbcWithMiniHS2.testAddJarConstructorUnCaching
    BUG-72900: Hive jdbc standalone jar has dependency on public hadoop jar
    BUG-74350: Enforce hive.enforce.bucketing=true for Acid writes on Hive1
    BUG-74570: TestCliDriver.testCliDriver_msck_repair_batchsize failure (q.out file update for test added in BUG-65355 HIVE-12077)
    BUG-73246: failing  TestMiniTezCliDriver schema_evol_*
    BUG-71844: Microstrategy query expected result mismatch
    HIVE-958: TestHeartBeat_1 failing due to timeout     BUG-74144: TestHCatLoader fail with jline CNF

  Pre-HDP-2.5.4:
    BUG-70863: TestCliDriver cast_on_constant failure - hive1     BUG-63178: hive 1 UT failures (org.apache.hadoop.hive.hwi.TestHWISessionManager.testHiveDriver and org.apache.hive.service.cli.thrift.TestThriftHttpCLIServiceFeatures.testForwardedHeaders)     BUG-63180 : hive 1 vectorization UT failures (org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_orc_nonvec_mapwork_part_all_primitive and org.apache.hadoop.hive.ql.io.orc.TestInputOutputFormat.testVectorizationWithAcid)
    HIVE-836: HDP 2.5/Erie- Datanucleus MSSQLServerAdapter generates incorrect syntax for OFFSET-FETCH clause     BUG-64529: Ranger: Masking is not triggered for metadata only queries

